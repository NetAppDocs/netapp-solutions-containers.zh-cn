---
sidebar: sidebar 
permalink: anthos/anthos-f5bigip-lb.html 
summary: 'F5 BIG-IP 是一种应用交付控制器 (ADC)，它提供广泛的先进生产级流量管理和安全服务，如 L4-L7 负载平衡、SSL/TLS 卸载、DNS、防火墙等。这些服务大大提高了应用程序的可用性、安全性和性能。' 
keywords: Anthos, GKE, Kubernetes, F5, BigIP, LoadBalancer 
---
= 安装 F5 BIG-IP 负载均衡器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
F5 BIG-IP 是一种应用交付控制器 (ADC)，它提供广泛的先进生产级流量管理和安全服务，如 L4-L7 负载平衡、SSL/TLS 卸载、DNS、防火墙等。这些服务极大地提高了应用程序的可用性、安全性和性能。

F5 BIG-IP 可以通过多种方式部署和使用，包括在专用硬件上、在云端或作为本地虚拟设备。请参阅此处的文档来探索和部署 F5 BIG-IP。

F5 BIG-IP 是第一个与 Anthos On-Prem 一起提供的捆绑负载均衡器解决方案，并被用于 Anthos with NetApp解决方案的许多早期 Anthos Ready 合作伙伴验证中。


NOTE: F5 BIG-IP 可以采用独立模式部署，也可以采用集群模式部署。为了进行此验证，F5 BIG-IP 以独立模式部署。但是，出于生产目的， NetApp建议创建一个 BIG-IP 实例集群，以避免单点故障。


NOTE: F5 BIG-IP 系统可以部署在专用硬件上、云端或作为本地虚拟设备部署，版本高于 12.x，以便与 F5 CIS 集成。为了本文档的目的，F5 BIG-IP 系统被验证为虚拟设备，例如使用 BIG-IP VE 版本。



== 已验证版本

该解决方案利用在 VMware vSphere 中部署的虚拟设备。根据您的网络环境，F5 Big-IP 虚拟设备的网络可以配置为双臂或三臂配置。本文档中的部署基于双臂配置。关于如何配置虚拟设备以与 Anthos 配合使用的详细信息，请参阅 https://cloud.google.com/solutions/partners/installing-f5-big-ip-adc-for-gke-on-prem["此处"]。

NetApp的解决方案工程团队已在我们的实验室中验证了下表中的版本，以便与 Anthos On-Prem 的部署配合使用：

|===


| 制作 | 类型 | 版本 


| F5 | BIG-IP虚拟网络 | 15.0.1-0.0.11 


| F5 | BIG-IP虚拟网络 | 16.1.0-0.0.19 
|===


== 安装

要安装 F5 BIG-IP，请完成以下步骤：

. 从 F5 下载虚拟应用程序开放虚拟设备 (OVA) 文件 https://downloads.f5.com/esd/serveDownload.jsp?path=/big-ip/big-ip_v15.x/15.0.1/english/virtual-edition/&sw=BIG-IP&pro=big-ip_v15.x&ver=15.0.1&container=Virtual-Edition&file=BIGIP-15.0.1-0.0.11.ALL-vmware.ova["此处"]。
+

NOTE: 要下载该设备，用户必须在 F5 注册。他们为 Big-IP Virtual Edition Load Balancer 提供了 30 天的演示许可证。  NetApp建议对设备的生产部署使用永久的 10Gbps 许可证。

. 右键单击基础设施资源池并选择部署 OVF 模板。将启动一个向导，允许您选择在步骤 1 中刚刚下载的 OVA 文件。单击“下一步”。
+
image:deploy-big-ip-001.png["部署 Big-IP 设备"]

. 单击“下一步”继续执行每个步骤并接受每个屏幕显示的默认值，直到到达存储选择屏幕。选择您想要部署虚拟机的 VM_Datastore，然后单击下一步。
. 向导显示的下一个屏幕允许您自定义在环境中使用的虚拟网络。在外部字段中选择 VM_Network，在管理字段中选择 Management_Network。 Internal 和 HA 用于 F5 Big-IP 设备的高级配置，未配置。这些参数可以保持不变，也可以配置为连接到非基础设施、分布式端口组。单击“下一步”。
+
image:deploy-big-ip-002.png["部署 Big_IP 设备，第 2 部分"]

. 查看设备的摘要屏幕，如果所有信息正确，请单击“完成”以开始部署。
. 虚拟设备部署完成后，右键单击并启动它。它应该在管理网络上接收 DHCP 地址。该设备基于 Linux，并且部署了 VMware Tools，因此您可以在 vSphere 客户端中查看它接收的 DHCP 地址。
+
image:deploy-big-ip-003.png["部署 Big-IP Appliance，第 3 部分"]

. 打开 Web 浏览器并使用上一步中的 IP 地址连接到设备。默认登录名为 admin/admin，首次登录后，设备会立即提示您更改管理员密码。然后它会返回到一个屏幕，您必须使用新的凭据登录。
+
image:big-ip-config-001.png["Big-IP 配置"]

. 第一个屏幕提示用户完成设置实用程序。单击“下一步”启动该实用程序。
+
image:big-ip-config-002.png["Big-IP 配置，第 2 部分"]

. 下一个屏幕提示激活设备的许可证。单击“激活”开始。当下一页出现提示时，粘贴您在注册下载时收到的 30 天评估许可证密钥或您购买设备时获得的永久许可证。单击“下一步”。
+
image:big-ip-config-003.png["Big-IP 配置，第 3 部分"]

+

NOTE: 为了使设备执行激活，管理接口上定义的网络必须能够访问互联网。

. 在下一个屏幕上，将显示最终用户许可协议 (EULA)。如果许可证中的条款可以接受，请单击“接受”。
. 下一个屏幕将计算经过的时间，以验证迄今为止所做的配置更改。单击“继续”以恢复初始配置。
+
image:big-ip-config-004.png["Big-IP 配置，第 4 部分"]

. 配置更改窗口关闭，设置实用程序显示资源配置菜单。此窗口列出了当前许可的功能以及虚拟设备和每个正在运行的服务的当前资源分配。
+
image:big-ip-config-005.png["Big-IP 配置，第 5 部分"]

. 单击左侧的平台菜单选项可以对平台进行进一步修改。修改包括设置使用 DHCP 配置的管理 IP 地址、设置设备安装的主机名和时区，以及保护设备免受 SSH 访问。
+
image:big-ip-config-006.png["Big-IP 配置，第 6 部分"]

. 接下来单击网络菜单，它使您能够配置标准网络功能。单击“下一步”开始标准网络配置向导。
+
image:big-ip-config-007.png["Big-IP 配置，第 7 部分"]

. 向导的第一页配置冗余；保留默认设置并单击下一步。下一页使您能够在负载均衡器上配置内部接口。接口 1.1 映射到 OVF 部署向导中标记为内部的 VMNIC。
+
image:big-ip-config-008.png["Big-IP 配置，第 8 部分"]

+

NOTE: 此页面中用于自 IP 地址、网络掩码和浮动 IP 地址的空间可以用不可路由的 IP 填充，以用作占位符。如果您正在部署三臂配置，它们还可以填充已配置为虚拟客户端分布式端口组的内部网络。必须完成这些操作才能继续向导。

. 下一页使您能够配置外部网络，用于将服务映射到 Kubernetes 中部署的 pod。从 VM_Network 范围中选择一个静态 IP、适当的子网掩码以及来自同一范围的浮动 IP。接口 1.2 映射到 OVF 部署向导中标记为外部的 VMNIC。
+
image:big-ip-config-009.png["Big-IP 配置，第 9 部分"]

. 在下一页中，如果您在环境中部署多个虚拟设备，则可以配置内部 HA 网络。要继续，您必须填写 Self-IP 地址和网络掩码字段，并且必须选择接口 1.3 作为 VLAN 接口，该接口映射到 OVF 模板向导定义的 HA 网络。
+
image:big-ip-config-010.png["Big-IP 配置，第 10 部分"]

. 下一页使您能够配置 NTP 服务器。然后单击“下一步”继续 DNS 设置。 DNS 服务器和域搜索列表应该已经由 DHCP 服务器填充。单击“下一步”接受默认设置并继续。
. 对于向导的剩余部分，单击“下一步”继续完成高级对等设置，其配置超出了本文档的范围。然后单击“完成”退出向导。
. 为 Anthos 管理员集群和环境中部署的每个用户集群创建单独的分区。单击左侧菜单中的“系统”，导航到“用户”，然后单击“分区列表”。
+
image:big-ip-config-011.png["Big-IP 配置，第 11 部分"]

. 显示的屏幕仅显示当前的公共分区。点击右侧的创建，创建第一个附加分区，并命名为 `GKE-Admin`。然后单击重复，并将分区命名为 `User-Cluster-1`。再次单击重复按钮以命名下一个分区 `User-Cluster-2`。最后单击“完成”以完成向导。分区列表屏幕返回，其中列出了所有分区。
+
image:big-ip-config-012.png["Big-IP 配置，第 12 部分"]





== 与 Anthos 集成

每个配置文件中都有一个部分，分别针对管理员集群和您选择部署的每个用户集群，以配置负载均衡器，以便由 Anthos On Prem 管理。

以下脚本是 GKE-Admin 集群分区配置的示例。需要取消注释和修改的值以粗体显示如下：

[listing, subs="+quotes,+verbatim"]
----
# (Required) Load balancer configuration
*loadBalancer:*
  # (Required) The VIPs to use for load balancing
  *vips:*
    # Used to connect to the Kubernetes API
    *controlPlaneVIP: "10.61.181.230"*
    # # (Optional) Used for admin cluster addons (needed for multi cluster features). Must
    # # be the same across clusters
    # # addonsVIP: ""
  # (Required) Which load balancer to use "F5BigIP" "Seesaw" or "ManualLB". Uncomment
  # the corresponding field below to provide the detailed spec
  *kind: F5BigIP*
  # # (Required when using "ManualLB" kind) Specify pre-defined nodeports
  # manualLB:
  #   # NodePort for ingress service's http (only needed for user cluster)
  #   ingressHTTPNodePort: 0
  #   # NodePort for ingress service's https (only needed for user cluster)
  #   ingressHTTPSNodePort: 0
  #   # NodePort for control plane service
  #   controlPlaneNodePort: 30968
  #   # NodePort for addon service (only needed for admin cluster)
  #   addonsNodePort: 31405
  # # (Required when using "F5BigIP" kind) Specify the already-existing partition and
  # # credentials
  *f5BigIP:*
    *address: "172.21.224.21"*
    *credentials:*
      *username: "admin"*
      *password: "admin-password"*
    *partition: "GKE-Admin"*
  #   # # (Optional) Specify a pool name if using SNAT
  #   # snatPoolName: ""
  # (Required when using "Seesaw" kind) Specify the Seesaw configs
  # seesaw:
    # (Required) The absolute or relative path to the yaml file to use for IP allocation
    # for LB VMs. Must contain one or two IPs.
    #  ipBlockFilePath: ""
    # (Required) The Virtual Router IDentifier of VRRP for the Seesaw group. Must
    # be between 1-255 and unique in a VLAN.
    #  vrid: 0
    # (Required) The IP announced by the master of Seesaw group
    #  masterIP: ""
    # (Required) The number CPUs per machine
    #  cpus: 4
    # (Required) Memory size in MB per machine
    #   memoryMB: 8192
    # (Optional) Network that the LB interface of Seesaw runs in (default: cluster
    # network)
    #   vCenter:
      # vSphere network name
      #     networkName: VM_Network
    # (Optional) Run two LB VMs to achieve high availability (default: false)
    #   enableHA: false
----